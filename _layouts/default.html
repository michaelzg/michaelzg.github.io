<!DOCTYPE html>
<html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js"></script>

{% include head.html %}
<body class="{% if site.animated %}animated fade-in-down{% endif %}{% if page.body_class %} {{ page.body_class }}{% endif %}">
  <div class="site-wrap">
    {% include header.html %}

    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        {{ content }}
      </div>
    </div>
  </div>

  {% include footer.html %}

<script>
(function() {
  var article = document.querySelector('.post-content');
  if (!article) {
    return;
  }

  var progressTrack = document.createElement('div');
  progressTrack.className = 'reading-progress';
  progressTrack.setAttribute('aria-hidden', 'true');

  var progressBar = document.createElement('div');
  progressBar.className = 'reading-progress__bar';
  progressTrack.appendChild(progressBar);
  document.documentElement.appendChild(progressTrack);

  function clamp(value, min, max) {
    return Math.min(max, Math.max(min, value));
  }

  function updateReadingProgress() {
    var articleTop = article.getBoundingClientRect().top + window.scrollY;
    var articleBottom = articleTop + article.offsetHeight;
    var maxScrollable = articleBottom - window.innerHeight;
    var progress = 0;

    if (maxScrollable <= articleTop) {
      progress = window.scrollY >= articleTop ? 1 : 0;
    } else {
      progress = (window.scrollY - articleTop) / (maxScrollable - articleTop);
    }

    progressBar.style.transform = 'scaleX(' + clamp(progress, 0, 1) + ')';
  }

  window.addEventListener('scroll', updateReadingProgress, { passive: true });
  window.addEventListener('resize', updateReadingProgress);
  updateReadingProgress();
})();
</script>

<script>
(function() {
  var DARK_START = 21, DARK_END = 7;

  function isDarkHour() {
    var h = new Date().getHours();
    return h >= DARK_START || h < DARK_END;
  }

  function applyTheme(dark) {
    if (dark) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
    var icon  = document.getElementById('global-toggle-icon');
    var label = document.getElementById('global-toggle-label');
    if (icon)  icon.textContent  = dark ? 'â˜€ï¸' : 'ðŸŒ™';
    if (label) label.textContent = dark ? 'Day' : 'Night';
  }

  // Build button and append to <html> (not <body>) so that body's
  // transform animation (fadeInDown) never breaks position:fixed
  var btn = document.createElement('button');
  btn.className = 'global-theme-toggle';
  btn.id = 'global-theme-toggle';
  btn.type = 'button';
  btn.setAttribute('aria-label', 'Toggle dark mode');
  btn.innerHTML = '<span class="toggle-icon" id="global-toggle-icon"></span><span id="global-toggle-label"></span>';
  document.documentElement.appendChild(btn);

  var override = sessionStorage.getItem('theme-override');
  var isDark = override === 'dark' || (!override && isDarkHour());
  applyTheme(isDark);

  btn.addEventListener('click', function() {
    var nowDark = document.documentElement.classList.contains('dark');
    var newDark = !nowDark;
    sessionStorage.setItem('theme-override', newDark ? 'dark' : 'light');
    applyTheme(newDark);
  });
})();
</script>

<script>
  document.addEventListener("DOMContentLoaded", function(event) {
  anchors.options.placement = 'left';
  anchors.add();
});
</script>

</body>
</html>
