---
layout: default
title: Life In Weeks
---

<style>
  .liw-container {
    width: 100vw;
    margin-left: calc(-50vw + 50%);
    box-sizing: border-box;
  }

  .liw-header {
    text-align: center;
    margin-bottom: 1rem;
  }

  .liw-header h1 {
    margin-bottom: 0.25rem;
  }

  .liw-header p {
    color: #666;
    margin-top: 0;
  }

  .liw-legend {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
    font-size: 0.8rem;
    padding: 0.5rem 1rem;
  }

  .liw-legend.liw-legend-sticky {
    position: sticky;
    top: 0;
    z-index: 50;
    background: rgba(255, 255, 255, 0.95);
    animation: liw-fade-in 0.4s ease forwards;
  }

  @keyframes liw-fade-in {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .liw-legend-item {
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }

  .liw-legend-swatch {
    display: inline-block;
    width: 14px;
    height: 14px;
    border-radius: 3px;
    flex-shrink: 0;
  }

  /* Match original: 60% viewport width, centered */
  .liw-grid {
    margin: 0 20%;
  }

  .liw-decade {
    padding: 4px 0;
    border-radius: 5px;
    margin-bottom: 2px;
  }

  /* Each row is its own flex container */
  .liw-flex-row {
    display: flex;
  }

  /* Base box — button reset + shared styles matching original */
  .liw-box {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: relative;
    height: 2em;
    max-height: 2em;
    padding: 2px 5px;
    margin: 2px 1px;
    border: 2px solid #ccc;
    border-radius: 4px;
    background: #f5f5f5;
    font-family: inherit;
    font-size: 1rem;
    color: #444;
    cursor: default;
    outline: none;
    -webkit-appearance: none;
    appearance: none;
    line-height: 1.2;
    box-sizing: border-box;
  }

  /* Empty boxes — fill available space equally (like original's w-100) */
  .liw-box:not(.liw-has-label) {
    width: 100%;
  }

  /* Labeled boxes — stay at content width */
  .liw-box.liw-has-label {
    white-space: nowrap;
    flex-shrink: 0;
  }

  .liw-box.liw-future {
    background-color: #eee !important;
    border-color: #dee2e6 !important;
  }

  /* Current week marker */
  .liw-box.liw-now {
    border-color: #f05d2b !important;
    box-shadow: 0 0 0 2px #f05d2b, 0 0 8px rgba(240, 93, 43, 0.4);
    z-index: 5;
  }

  /* Tooltip — below the box, matching original orange */
  .liw-box .liw-tip {
    display: none;
    position: absolute;
    top: calc(100% + 5px);
    left: 50%;
    transform: translateX(-50%);
    background: #f05d2b;
    color: #fff;
    font-size: 0.7rem;
    padding: 6px 10px;
    border-radius: 4px;
    white-space: nowrap;
    z-index: 30;
    pointer-events: none;
    max-width: 300px;
  }

  .liw-tip-date {
    font-weight: bold;
    margin-bottom: 2px;
  }

  .liw-tip-label {
    margin-bottom: 2px;
  }

  .liw-tip-desc {
    white-space: normal;
    opacity: 0.9;
    font-style: italic;
    border-top: 1px solid rgba(255,255,255,0.3);
    padding-top: 3px;
    margin-top: 3px;
  }

  .liw-box .liw-tip::before {
    content: '';
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 5px solid transparent;
    border-bottom-color: #f05d2b;
  }

  .liw-box:hover .liw-tip,
  .liw-box:focus .liw-tip {
    display: block;
  }

  .liw-box.liw-future .liw-tip {
    display: none !important;
  }

  /* Go to Now button */
  .liw-go-now {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    padding: 0.25rem 0.7rem;
    border: 2px solid #f05d2b;
    border-radius: 16px;
    background: #fff;
    color: #f05d2b;
    font-size: 0.8rem;
    font-family: inherit;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s, color 0.2s, transform 0.15s;
    -webkit-appearance: none;
    appearance: none;
  }

  .liw-go-now:hover {
    background: #f05d2b;
    color: #fff;
    transform: scale(1.05);
  }

  .liw-go-now:active {
    transform: scale(0.97);
  }

  @media only screen and (max-width: 768px) {
    .liw-grid {
      margin: 0 2%;
    }
    .liw-box {
      font-size: 0.75rem;
    }
  }
</style>

<div class="liw-container">
  <div class="liw-header">
    <h1>Life In Weeks</h1>
    <p>Each box is one week. Colors are decades.</p>
  </div>

  {% assign liw = site.data.life-in-weeks %}
  <div class="liw-legend">
    {% for decade in liw.decades %}
    <span class="liw-legend-item">
      <span class="liw-legend-swatch" style="border: 2px solid {{ decade.border }}; background: {{ decade.fill }};"></span>
      {{ decade.label }}
    </span>
    {% endfor %}
    <span class="liw-legend-item">
      <span class="liw-legend-swatch" style="border: 2px solid #dee2e6; background: #eee;"></span>
      Future
    </span>
    <button class="liw-go-now" id="go-now" type="button">&#x2193; Go to Now</button>
  </div>

  <div class="liw-grid" id="grid"></div>
</div>

<script>
(function () {
  {% assign liw = site.data.life-in-weeks %}
  var CONFIG = {{ liw | jsonify }};

  var birthParts = CONFIG.birthday.split('-');
  var BIRTH = new Date(parseInt(birthParts[0], 10), parseInt(birthParts[1], 10) - 1, parseInt(birthParts[2], 10));
  var LIFESPAN = CONFIG.lifespan_years;
  var MS_PER_WEEK = 7 * 24 * 60 * 60 * 1000;
  var WEEKS_PER_YEAR = 52;
  var NOW = new Date();

  var DECADES = CONFIG.decades;
  var EVENTS = CONFIG.events;

  // Row control — matching original's multipliers
  var MAX_BOXES_IN_ROW = 21;
  var BOX_END_MULT = 0.45;
  var BOX_CHAR_MULT = 0.319;

  function parseDate(s) {
    var parts = s.split('-');
    return new Date(parseInt(parts[0], 10), parseInt(parts[1], 10) - 1, parseInt(parts[2], 10));
  }

  // Build week-index -> event(s) lookup
  var eventsByWeek = {};
  EVENTS.forEach(function (evt) {
    var d = parseDate(evt.date);
    var weekIdx = Math.floor((d - BIRTH) / MS_PER_WEEK);
    if (!eventsByWeek[weekIdx]) eventsByWeek[weekIdx] = [];
    eventsByWeek[weekIdx].push(evt);
  });

  // Auto-generate birthday events
  for (var age = 1; age < LIFESPAN; age++) {
    var bdayDate = new Date(BIRTH.getFullYear() + age, BIRTH.getMonth(), BIRTH.getDate());
    var weekIdx = Math.floor((bdayDate - BIRTH) / MS_PER_WEEK);
    var bdayEvt = {
      label: '\uD83C\uDF82 ' + age + ' in ' + (BIRTH.getFullYear() + age),
      description: 'Turned ' + age + ' year' + (age !== 1 ? 's' : '') + ' old',
      isBirthday: true
    };
    if (!eventsByWeek[weekIdx]) eventsByWeek[weekIdx] = [];
    eventsByWeek[weekIdx].unshift(bdayEvt);
  }

  var MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  function fmtDate(d) {
    return MONTHS[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
  }

  // Count visual characters (treat each emoji/grapheme as ~2 chars width)
  function visualLength(str) {
    if (!str) return 0;
    // Use Intl.Segmenter if available for accurate grapheme counting
    if (typeof Intl !== 'undefined' && Intl.Segmenter) {
      var segmenter = new Intl.Segmenter('en', { granularity: 'grapheme' });
      var len = 0;
      for (var seg of segmenter.segment(str)) {
        // Emojis and multi-codepoint chars get extra width
        len += seg.segment.length > 1 ? 2 : 1;
      }
      return len;
    }
    // Fallback: rough heuristic using string length
    return str.length;
  }

  function boxUnits(label) {
    if (!label) return 1;
    return 2 * BOX_END_MULT + visualLength(label) * BOX_CHAR_MULT;
  }

  var gridEl = document.getElementById('grid');

  var currentDecade = -1;
  var decadeDiv = null;
  var currentRow = null;
  var rowUnits = 0;

  function createRow() {
    currentRow = document.createElement('div');
    currentRow.className = 'liw-flex-row';
    decadeDiv.appendChild(currentRow);
    rowUnits = 0;
  }

  function ensureRowSpace(units) {
    if (rowUnits > 0 && rowUnits + units >= MAX_BOXES_IN_ROW) {
      createRow();
    }
  }

  var totalWeeks = LIFESPAN * WEEKS_PER_YEAR;

  // Track the current week's box for "Go to Now"
  var currentWeekIdx = Math.floor((NOW - BIRTH) / MS_PER_WEEK);
  var nowBox = null;

  for (var w = 0; w < totalWeeks; w++) {
    var yearOfLife = Math.floor(w / WEEKS_PER_YEAR);
    var decade = Math.floor(yearOfLife / 10);
    var weekStart = new Date(BIRTH.getTime() + w * MS_PER_WEEK);
    var isFuture = weekStart > NOW;
    var isNow = (w === currentWeekIdx);

    // New decade section
    if (decade !== currentDecade) {
      currentDecade = decade;
      decadeDiv = document.createElement('div');
      decadeDiv.className = 'liw-decade';
      gridEl.appendChild(decadeDiv);
      createRow();
    }

    var evtsThisWeek = eventsByWeek[w];
    var decadeColors = DECADES[decade] || DECADES[DECADES.length - 1];

    // Build inline label
    var boxLabel = '';
    if (evtsThisWeek) {
      boxLabel = evtsThisWeek.map(function (e) { return e.label; }).join(' \u00b7 ');
    }

    // Check row space before inserting
    var units = boxUnits(boxLabel);
    ensureRowSpace(units);

    // Create box
    var box = document.createElement('button');
    box.type = 'button';
    box.className = 'liw-box' + (isFuture ? ' liw-future' : '') + (boxLabel ? ' liw-has-label' : '') + (isNow ? ' liw-now' : '');
    box.style.borderColor = decadeColors.border;
    if (!isFuture) {
      box.style.backgroundColor = decadeColors.fill;
    }

    if (isNow) {
      nowBox = box;
    }

    if (boxLabel) {
      box.textContent = boxLabel;
    }

    // Tooltip
    if (!isFuture) {
      var tip = document.createElement('span');
      tip.className = 'liw-tip';

      var dateDiv = document.createElement('div');
      dateDiv.className = 'liw-tip-date';
      dateDiv.textContent = fmtDate(weekStart);
      tip.appendChild(dateDiv);

      if (evtsThisWeek) {
        var labels = evtsThisWeek.map(function (e) { return e.label; });
        var labelDiv = document.createElement('div');
        labelDiv.className = 'liw-tip-label';
        labelDiv.textContent = labels.join(' \u00b7 ');
        tip.appendChild(labelDiv);

        // Show descriptions if any event has one
        var descs = evtsThisWeek.filter(function (e) { return e.description; });
        if (descs.length > 0) {
          var descDiv = document.createElement('div');
          descDiv.className = 'liw-tip-desc';
          descDiv.textContent = descs.map(function (e) { return e.description; }).join(' \u00b7 ');
          tip.appendChild(descDiv);
        }
      } else {
        var age = weekStart.getFullYear() - BIRTH.getFullYear();
        if (weekStart.getMonth() < BIRTH.getMonth() ||
            (weekStart.getMonth() === BIRTH.getMonth() && weekStart.getDate() < BIRTH.getDate())) {
          age--;
        }
        var ageDiv = document.createElement('div');
        ageDiv.className = 'liw-tip-label';
        ageDiv.textContent = 'Age ' + age;
        tip.appendChild(ageDiv);
      }

      if (isNow) {
        var nowDiv = document.createElement('div');
        nowDiv.className = 'liw-tip-label';
        nowDiv.style.fontWeight = 'bold';
        nowDiv.textContent = '\u2190 You are here';
        tip.appendChild(nowDiv);
      }

      box.appendChild(tip);
    }

    currentRow.appendChild(box);
    rowUnits += units;

    // Break after if row is full
    if (rowUnits >= MAX_BOXES_IN_ROW) {
      createRow();
    }
  }
  // Sticky legend: becomes sticky once scrolled past its natural position
  var legend = document.querySelector('.liw-legend');
  var legendTop = legend.offsetTop;
  window.addEventListener('scroll', function () {
    if (window.scrollY > legendTop) {
      legend.classList.add('liw-legend-sticky');
    } else {
      legend.classList.remove('liw-legend-sticky');
    }
  }, { passive: true });

  // "Go to Now" button
  document.getElementById('go-now').addEventListener('click', function () {
    if (!nowBox) return;
    nowBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
    // Brief pulse animation on arrival
    nowBox.style.transition = 'box-shadow 0.3s ease';
    setTimeout(function () {
      nowBox.style.boxShadow = '0 0 0 4px #f05d2b, 0 0 20px rgba(240, 93, 43, 0.6)';
      setTimeout(function () {
        nowBox.style.boxShadow = '0 0 0 2px #f05d2b, 0 0 8px rgba(240, 93, 43, 0.4)';
      }, 600);
    }, 500);
  });
})();
</script>
